# Test agent configuration for mega integration test
# This file defines a realistic test scenario with multi-stage chain processing

agents:
  # Data Collection Agent for gathering kubernetes information
  DataCollectionAgent:
    custom_instructions: |
      You are a Kubernetes data collection specialist. Your role is to gather comprehensive 
      information about problematic resources using available kubectl tools.
      
      Focus on:
      - Namespace status and finalizers
      - Pod states and termination details  
      - Events showing errors and warnings
      - Resource dependencies that might block cleanup
      
      Be thorough but efficient. Collect all relevant data before stopping.
    mcp_servers:
      - "kubernetes-server"  # Use built-in kubernetes server for simplicity
      - "test-data-server"   # Custom server for additional data collection

  # Analysis Agent for root cause analysis
  AnalysisAgent:
    custom_instructions: |
      You are a Senior Site Reliability Engineer specializing in Kubernetes troubleshooting.
      Analyze the collected data from previous stages to identify root causes.
      
      Your analysis should:
      - Synthesize information from all data collection activities
      - Identify the specific root cause of the problem
      - Assess the impact and urgency level
      - Provide confidence levels for your conclusions
      
      Be precise and actionable in your analysis.
    mcp_servers:
      - "kubernetes-server"  # Use built-in kubernetes server
    
# MCP servers configuration for test environment
# We use the built-in kubernetes-server for simplicity in testing
mcp_servers:
  test-data-server:
    server_id: "test-data-server"
    server_type: "custom"
    enabled: true
    transport:
      type: "stdio"
      command: "echo"
      args: ["test-data-server-ready"]
    instructions: "Simple data collection server for testing - provides system information gathering tools"
    data_masking:
      enabled: false
    summarization:
      enabled: true
      size_threshold_tokens: 100    # Low threshold to trigger summarization in tests
      summary_max_token_limit: 50  # Reasonable limit for test summaries

# Agent chains configuration - this is the key part for our test
agent_chains:
  # Test chain for namespace terminating scenario
  kubernetes-namespace-terminating-chain:
    alert_types:
      - "test-kubernetes"
      - "test-NamespaceTerminating"
    chat:
      enabled: true
      agent: "ChatAgent"
      iteration_strategy: "react"           # Custom: Force ReAct strategy
      llm_provider: "openai-default"        # Custom: Use OpenAI
    stages:
      - name: "data-collection"
        agent: "DataCollectionAgent"
        iteration_strategy: "react-stage"
      - name: "verification"
        agent: "KubernetesAgent"     # This is a built-in agent that should to be available
        iteration_strategy: "react"
      - name: "analysis"  
        agent: "AnalysisAgent"
        iteration_strategy: "react-final-analysis"
    description: "Multi-stage chain: data collection → built-in agent verification → final analysis"
