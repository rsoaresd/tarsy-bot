# Test agent configuration for parallel execution E2E tests
# This file defines test chains for parallel agent execution scenarios

agents:
  # Kubernetes specialist agent for parallel multi-agent testing
  KubernetesAgent:
    custom_instructions: |
      You are a Kubernetes specialist analyzing pod health and resource issues.
      Focus on pod status, events, and resource constraints.
    mcp_servers:
      - "kubernetes-server"
  
  # Log analysis agent for parallel multi-agent testing
  LogAgent:
    custom_instructions: |
      You are a log analysis specialist focusing on application errors and patterns.
      Analyze logs to identify root causes and anomalies.
    mcp_servers:
      - "kubernetes-server"
  
  # Command agent for formulating remediation steps
  CommandAgent:
    custom_instructions: |
      You are a command execution specialist that formulates remediation steps based on investigation results.
    mcp_servers:
      - "kubernetes-server"

# MCP servers for test environment
# Note: Using builtin kubernetes-server for all agents to simplify test setup

# Agent chains configuration
agent_chains:
  # Test chain 1: Multi-agent parallel stage with automatic synthesis
  multi-agent-parallel-chain:
    alert_types:
      - "test-parallel-execution"
    stages:
      - name: "investigation"
        agents:
          - name: "KubernetesAgent"
            llm_provider: "google-default"
            iteration_strategy: "native-thinking"
          - name: "LogAgent"
            llm_provider: "anthropic-default"
            iteration_strategy: "react"
        success_policy: "all"  # Both must succeed
        # Synthesis configuration (test uses ReAct mocks)
        synthesis:
          agent: "SynthesisAgent"
          iteration_strategy: "synthesis-native-thinking"
          llm_provider: "google-default"
    description: "Multi-agent parallel stage with automatic synthesis (final stage)"
  
  # Test chain 2: Replica parallel stage with automatic synthesis
  # MCP Config Test: Chain-level configuration
  replica-parallel-chain:
    alert_types:
      - "test-replica-execution"
    mcp_servers:
      - "kubernetes-server"  # Chain-level: All stages inherit this
    stages:
      - name: "analysis"
        agent: "KubernetesAgent"
        replicas: 3
        llm_provider: "google-default"
        iteration_strategy: "native-thinking"
        success_policy: "any"  # At least one must succeed
        # Synthesis configuration (test uses simple synthesis strategy)
        synthesis:
          agent: "SynthesisAgent"
          iteration_strategy: "synthesis"
          llm_provider: "anthropic-default"
    description: "Replica parallel stage (3 replicas) with automatic synthesis | MCP: chain-level"
  
  # Test chain 3: Parallel stage with auto-synthesis followed by regular stage
  # MCP Config Test: Stage-level configuration
  parallel-then-regular-chain:
    alert_types:
      - "test-parallel-regular-execution"
    stages:
      - name: "investigation"
        mcp_servers:
          - "kubernetes-server"  # Stage-level: Applies to all agents in this stage
        agents:
          - name: "KubernetesAgent"
            llm_provider: "google-default"
            iteration_strategy: "native-thinking"
          - name: "LogAgent"
            llm_provider: "anthropic-default"
            iteration_strategy: "react"
        success_policy: "all"
        # Note: synthesis config is optional and omitted here to test defaults
        # Automatic synthesis will use: SynthesisAgent with 'synthesis' strategy
      - name: "command"
        agent: "CommandAgent"
        iteration_strategy: "react-final-analysis"
        llm_provider: "google-default"
        mcp_servers:
          - "kubernetes-server"  # Stage-level: For regular stage
    description: "Parallel stage with automatic synthesis followed by regular stage | MCP: stage-level"
  
  # Test chain 4: Multi-agent parallel with success_policy: any (for cancel tests)
  # MCP Config Test: Chain + Stage levels (structural test - both use same server for simplicity)
  # Note: Precedence verification is handled by unit tests in test_mcp_config_resolver.py
  multi-agent-cancel-test-chain:
    alert_types:
      - "test-cancel-agent-execution"
    mcp_servers:
      - "kubernetes-server"  # Chain-level: Baseline
    stages:
      - name: "investigation"
        mcp_servers:
          - "kubernetes-server"  # Stage-level: Tests structural validity (same value for test simplicity)
        agents:
          - name: "KubernetesAgent"
            llm_provider: "google-default"
            iteration_strategy: "native-thinking"
          - name: "LogAgent"
            llm_provider: "anthropic-default"
            iteration_strategy: "react"
        success_policy: "any"  # At least one must succeed - used for cancel tests
        synthesis:
          agent: "SynthesisAgent"
          iteration_strategy: "synthesis-native-thinking"
          llm_provider: "google-default"
    description: "Multi-agent parallel with success_policy: any for per-agent cancellation tests | MCP: chain+stage-level"

  # Test chain 5: Multi-agent parallel (3 agents) with success_policy: any (for cancel tests)
  # MCP Config Test: Mixed levels - Chain + parallel-agent (structural test - both use same server for simplicity)
  # Note: Precedence verification is handled by unit tests in test_mcp_config_resolver.py
  multi-agent-cancel-three-agent-test-chain:
    alert_types:
      - "test-cancel-agent-execution-three-agents"
    mcp_servers:
      - "kubernetes-server"  # Chain-level: Baseline for all
    stages:
      - name: "investigation"
        agents:
          - name: "KubernetesAgent"
            llm_provider: "google-default"
            iteration_strategy: "native-thinking"
            # No MCP override - inherits chain-level
          - name: "LogAgent"
            llm_provider: "anthropic-default"
            iteration_strategy: "react"
            mcp_servers:
              - "kubernetes-server"  # Parallel-agent-level: Tests structural validity (same value for test simplicity)
          - name: "CommandAgent"
            llm_provider: "anthropic-default"
            iteration_strategy: "react"
            # No MCP override - inherits chain-level
        success_policy: "any"
        synthesis:
          agent: "SynthesisAgent"
          iteration_strategy: "synthesis-native-thinking"
          llm_provider: "google-default"
    description: "3-agent parallel stage with success_policy: any for per-agent cancellation tests | MCP: chain+parallel-agent-level"
  
  # Test chain 6: Multi-agent parallel with forced conclusion (for forced conclusion tests)
  # MCP Config Test: Parallel-agent-level configuration (highest precedence)
  multi-agent-forced-conclusion-chain:
    alert_types:
      - "test-forced-conclusion-parallel"
    max_iterations: 2  # Chain-level: Applies to all stages and chat
    force_conclusion_at_max_iterations: true  # Chain-level: Force conclusion instead of pause
    stages:
      - name: "investigation"
        agents:
          - name: "KubernetesAgent"
            llm_provider: "google-default"
            iteration_strategy: "native-thinking"
            mcp_servers:
              - "kubernetes-server"  # Parallel-agent-level: Per-agent MCP config
          - name: "LogAgent"
            llm_provider: "anthropic-default"
            iteration_strategy: "react"
            mcp_servers:
              - "kubernetes-server"  # Parallel-agent-level: Per-agent MCP config
        success_policy: "all"
        synthesis:
          agent: "SynthesisAgent"
          iteration_strategy: "synthesis-native-thinking"
          llm_provider: "google-default"
    description: "Multi-agent parallel with mixed iteration strategies for forced conclusion tests | MCP: parallel-agent-level (synthesis doesn't use MCP tools)"
  